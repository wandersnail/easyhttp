package com.snail.network.download

import com.snail.network.TaskInfo
import java.io.File
import java.util.*

/**
 * 时间: 2017/7/8 20:13
 * 作者: zengfansheng
 * 功能: 下载信息类，包含下载状态及进度监听
 */
open class DownloadInfo @JvmOverloads constructor(
    url: String,
    /** 文件保存路径 */
    val savePath: String,
    /** 唯一标识 */
    tag: String = UUID.randomUUID().toString()) : TaskInfo(url, tag) {
    /** 进度：总长度 */
    var contentLength: Long = 0
        internal set
    /** 进度：已完成长度 */
    var completionLength: Long = 0
        internal set
    /**
     * 获取下载的临时文件，下载完成后再重命名
     */
    internal val temporaryFilePath: String
        get() = "$savePath.temp"
    
    override fun reset() {
        completionLength = 0
        contentLength = 0
        File(temporaryFilePath).delete()
    }
    
    override fun equals(other: Any?): Boolean {
        return this === other || other is DownloadInfo && url == other.url
    }

    override fun hashCode(): Int {
        return url.hashCode()
    }
}
